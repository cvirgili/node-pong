var BGaudio=new Audio("/contents/audio/Background.mp3"),ballaudio=new Audio("/contents/audio/Laser.mp3"),goalaudio=new Audio("/contents/audio/Goal.mp3"),applauseaudio=new Audio("/contents/audio/Applause.mp3");
window.addEventListener("DOMContentLoaded",function(){var v=document.getElementById("renderCanvas"),r=new BABYLON.Engine(v,!0),k=2,w=function(){var f=0,p=0,a=new BABYLON.Scene(r),l=new BABYLON.StandardMaterial("wallmaterial",a);l.specularColor=new BABYLON.Color3(1,1,1);l.diffuseColor=new BABYLON.Color3(1,1,1);l.emissiveColor=new BABYLON.Color3(1,1,1);var e=new BABYLON.Vector3(0,0,0),h=new BABYLON.CannonJSPlugin;a.enablePhysics(e,h);a.ambientColor=new BABYLON.Color3(1,1,1);(new BABYLON.FreeCamera("camera1",
new BABYLON.Vector3(0,0,-12),a)).setTarget(BABYLON.Vector3.Zero());new BABYLON.PointLight("light1",new BABYLON.Vector3(0,0,-1E3),a);e=BABYLON.Mesh.CreatePlane("middlerow",.1,a);e.scaling.y=80;e.material=l;var b=BABYLON.Mesh.CreateSphere("sphere1",8,.4,a);b.material=new BABYLON.StandardMaterial("spherematerial",a);b.material.diffuseColor=new BABYLON.Color3(.8,.8,0);b.material.emissiveColor=new BABYLON.Color3(.5,.5,0);b.material.specularColor=new BABYLON.Color3(1,1,0);b.position.y=0;var d=BABYLON.Mesh.CreateBox("box1",
.2,a);d.scaling.y=12;d.scaling.z=2;d.position.x=-6;d.position.z=-.2;d.material=new BABYLON.StandardMaterial("box1mat",a);d.material.diffuseColor=new BABYLON.Color3(1,.766,.336);d.material.emissiveColor=new BABYLON.Color3(1,.766,.336);d.material.specularColor=new BABYLON.Color3(1,.766,.336);var c=BABYLON.Mesh.CreateBox("box2",.2,a);c.scaling.y=12;c.scaling.z=2;c.position.x=6;c.position.z=-.2;c.material=new BABYLON.StandardMaterial("box1mat",a);c.material.diffuseColor=new BABYLON.Color3(0,.766,1);c.material.emissiveColor=
new BABYLON.Color3(0,.766,1);c.material.specularColor=new BABYLON.Color3(0,.766,1);e=BABYLON.Mesh.CreateBox("goal1",.1,a);h=BABYLON.Mesh.CreateBox("goal2",.1,a);e.scaling.y=80.55;h.scaling.y=80.55;e.position.x=-7.5;h.position.x=7.5;e.material=l;h.material=l;var q=new BABYLON.DynamicTexture("textTitle",{width:800,height:800},a,!0);q.drawText("00 00",null,null,"Bold 380px Consolas","rgba(255,255,255,1.0)","rgba(0,0,0,0)");q.update();var g=new BABYLON.StandardMaterial("titleMat",a);g.diffuseTexture=
q;g.diffuseTexture.hasAlpha=!0;g.emissiveColor=BABYLON.Color3.White();BABYLON.Mesh.CreatePlane("title",4,a).material=g;g=BABYLON.Mesh.CreatePlane("wall1",.1,a);g.scaling.x=150;g.position.y=4;g.material=l;var n=BABYLON.Mesh.CreatePlane("wall2",.1,a);n.scaling.x=150;n.position.y=-4;n.material=l;a.collisionsEnabled=!0;d.checkCollisions=!0;c.checkCollisions=!0;b.checkCollisions=!0;g.checkCollisions=!0;n.checkCollisions=!0;e.checkCollisions=!0;h.checkCollisions=!0;d.physicsImpostor=new BABYLON.PhysicsImpostor(d,
BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});c.physicsImpostor=new BABYLON.PhysicsImpostor(c,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});b.physicsImpostor=new BABYLON.PhysicsImpostor(b,BABYLON.PhysicsImpostor.SphereImpostor,{mass:1,restitution:1});g.physicsImpostor=new BABYLON.PhysicsImpostor(g,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});n.physicsImpostor=new BABYLON.PhysicsImpostor(n,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,
restitution:1,move:!1});e.physicsImpostor=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:0,move:!1});h.physicsImpostor=new BABYLON.PhysicsImpostor(h,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:0,move:!1});e.physicsImpostor.physicsBody.collisionResponse=!1;h.physicsImpostor.physicsBody.collisionResponse=!1;b.physicsImpostor.registerOnPhysicsCollide(d.physicsImpostor,function(m,a){u(b,d,m,k)});b.physicsImpostor.registerOnPhysicsCollide(c.physicsImpostor,
function(m,a){u(b,c,m,-k)});b.physicsImpostor.registerOnPhysicsCollide(e.physicsImpostor,function(m,a){p++;t(2)});b.physicsImpostor.registerOnPhysicsCollide(h.physicsImpostor,function(m,a){f++;t(1)});var t=function(a){applauseaudio.currentTime=0;applauseaudio.play();k=2;if(1==a&&0<f||2==a&&0<p)goalaudio.currentTime=0,goalaudio.play();q.getContext().clearRect(0,0,window.innerWidth,window.innerHeight);q.drawText(("0"+f).slice(-2)+" "+("0"+p).slice(-2),null,null,"Bold 380px Consolas","rgba(255,255,255,1.0)",
"rgba(0,0,0,0)");-1!=a&&socket.emit("goal",{n:a,point1:f,point2:p})},u=function(a,b,d,c){ballaudio.currentTime=0;ballaudio.play();k=6<k?6:k+.08;var m=1.5*(a.position.y-b.position.y);c*=1+Math.abs(a.position.y-b.position.y);d.setLinearVelocity(new BABYLON.Vector3(c,m,0))};socket.on("player",function(a){1==a.n&&(d.position.y=a.y);2==a.n&&(c.position.y=a.y)});socket.on("start",function(a){b.position.x=1==a?d.position.x+.1:c.position.x-.1;b.position.y=1==a?d.position.y:c.position.y;b.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(1==
a?k:-k,0,0))});socket.on("showqr",function(a){$("#player"+a).show();$("#photo"+a).hide();b.position.x=0;b.position.y=0;d.position.y=0;p=f=c.position.y=0;b.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(0,0,0));t(-1);BGaudio.pause()});return a}();r.runRenderLoop(function(){w.render()});window.addEventListener("resize",function(){r.resize()});socket.on("hideqr",function(f){$("#player"+f).hide();$("#photo"+f).show()});socket.on("user-photo",function(f){$("#photo"+f.n).css({background:"url("+f.url+
")","background-size":"contain","background-position":"center","background-repeat":"no-repeat"})});socket.on("ready",function(){BGaudio.currentTime=0;BGaudio.play()});socket.on("connect",function(){socket.emit("resetclients")});BGaudio.addEventListener("ended",function(){this.currentTime=0;this.play()},!1)});