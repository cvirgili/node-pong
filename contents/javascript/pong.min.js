var BGaudio=new Audio("/contents/audio/Background.mp3"),ballaudio=new Audio("/contents/audio/Laser.mp3"),goalaudio=new Audio("/contents/audio/Goal.mp3"),applauseaudio=new Audio("/contents/audio/Applause.mp3");
window.addEventListener("DOMContentLoaded",function(){BGaudio.pause();ballaudio.pause();goalaudio.pause();applauseaudio.pause();var w=document.getElementById("renderCanvas"),q=new BABYLON.Engine(w,!0),k=2,x=function(){var f=0,n=0,a=new BABYLON.Scene(q),l=new BABYLON.StandardMaterial("wallmaterial",a);l.specularColor=new BABYLON.Color3(1,1,1);l.diffuseColor=new BABYLON.Color3(1,1,1);l.emissiveColor=new BABYLON.Color3(1,1,1);var c=new BABYLON.Vector3(0,0,0),h=new BABYLON.CannonJSPlugin;a.enablePhysics(c,
h);a.ambientColor=new BABYLON.Color3(1,1,1);(new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,0,-12),a)).setTarget(BABYLON.Vector3.Zero());new BABYLON.PointLight("light1",new BABYLON.Vector3(0,0,-1E3),a);c=BABYLON.Mesh.CreatePlane("middlerow",.1,a);c.scaling.y=80;c.material=l;var b=BABYLON.Mesh.CreateSphere("sphere1",8,.4,a);b.material=new BABYLON.StandardMaterial("spherematerial",a);b.material.diffuseColor=new BABYLON.Color3(.8,.8,0);b.material.emissiveColor=new BABYLON.Color3(.5,.5,0);b.material.specularColor=
new BABYLON.Color3(1,1,0);b.position.y=0;c=BABYLON.Mesh.CreateBox("floor",200,a);c.position.z=.5;c.scaling.z=.00001;c.material=new BABYLON.StandardMaterial("floor",a);c.material.diffuseColor=new BABYLON.Color3(.2,.2,.2);c.material.specularColor=new BABYLON.Color3(0,0,0);var d=BABYLON.Mesh.CreateBox("box1",.2,a);d.scaling.y=9.5;d.scaling.z=4;d.position.x=-6;d.position.z=0;d.material=new BABYLON.StandardMaterial("box1mat",a);d.material.diffuseColor=new BABYLON.Color3(1,.766,.336);d.material.emissiveColor=
new BABYLON.Color3(1,.766,.336);d.material.specularColor=new BABYLON.Color3(1,.766,.336);var e=BABYLON.Mesh.CreateBox("box2",.2,a);e.scaling.y=9.5;e.scaling.z=4;e.position.x=6;e.position.z=0;e.material=new BABYLON.StandardMaterial("box1mat",a);e.material.diffuseColor=new BABYLON.Color3(0,.766,1);e.material.emissiveColor=new BABYLON.Color3(0,.766,1);e.material.specularColor=new BABYLON.Color3(0,.766,1);c=BABYLON.Mesh.CreateBox("goal1",.1,a);h=BABYLON.Mesh.CreateBox("goal2",.1,a);c.scaling.y=80.55;
h.scaling.y=80.55;c.position.x=-7.5;h.position.x=7.5;c.material=l;h.material=l;var p=new BABYLON.DynamicTexture("textTitle",{width:800,height:800},a,!0);p.drawText("00 00",null,null,"Bold 380px Consolas","rgba(255,255,255,1.0)","rgba(0,0,0,0)");p.update();var g=new BABYLON.StandardMaterial("titleMat",a);g.diffuseTexture=p;g.diffuseTexture.hasAlpha=!0;g.emissiveColor=BABYLON.Color3.White();BABYLON.Mesh.CreatePlane("title",4,a).material=g;g=BABYLON.Mesh.CreatePlane("wall1",.1,a);g.scaling.x=150;g.position.y=
4;g.material=l;var m=BABYLON.Mesh.CreatePlane("wall2",.1,a);m.scaling.x=150;m.position.y=-4;m.material=l;a.collisionsEnabled=!0;d.checkCollisions=!0;e.checkCollisions=!0;b.checkCollisions=!0;g.checkCollisions=!0;m.checkCollisions=!0;c.checkCollisions=!0;h.checkCollisions=!0;d.physicsImpostor=new BABYLON.PhysicsImpostor(d,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});e.physicsImpostor=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});
b.physicsImpostor=new BABYLON.PhysicsImpostor(b,BABYLON.PhysicsImpostor.SphereImpostor,{mass:1,restitution:1});g.physicsImpostor=new BABYLON.PhysicsImpostor(g,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});m.physicsImpostor=new BABYLON.PhysicsImpostor(m,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,move:!1});c.physicsImpostor=new BABYLON.PhysicsImpostor(c,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:0,move:!1});h.physicsImpostor=new BABYLON.PhysicsImpostor(h,
BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:0,move:!1});c.physicsImpostor.physicsBody.collisionResponse=!1;h.physicsImpostor.physicsBody.collisionResponse=!1;b.physicsImpostor.registerOnPhysicsCollide(d.physicsImpostor,function(r,a){u(b,d,r,k)});b.physicsImpostor.registerOnPhysicsCollide(e.physicsImpostor,function(r,a){u(b,e,r,-k)});b.physicsImpostor.registerOnPhysicsCollide(c.physicsImpostor,function(a,b){n++;t(2)});b.physicsImpostor.registerOnPhysicsCollide(h.physicsImpostor,function(a,
b){f++;t(1)});var t=function(a){k=2;if(1==a&&0<f||2==a&&0<n)applauseaudio.currentTime=0,applauseaudio.play(),goalaudio.currentTime=0,goalaudio.play();p.getContext().clearRect(0,0,window.innerWidth,window.innerHeight);p.drawText(("0"+f).slice(-2)+" "+("0"+n).slice(-2),null,null,"Bold 380px Consolas","rgba(255,255,255,1.0)","rgba(0,0,0,0)");-1!=a&&socket.emit("goal",{n:a,point1:f,point2:n})},u=function(a,b,c,d){ballaudio.currentTime=0;ballaudio.play();k=6<k?6:k+.08;var e=1.5*(a.position.y-b.position.y);
d*=1+Math.abs(a.position.y-b.position.y);c.setLinearVelocity(new BABYLON.Vector3(d,e,0))},v=function(){b.position.x=0;b.position.y=0;d.position.y=0;n=f=e.position.y=0;b.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(0,0,0));t(-1);BGaudio.pause()};socket.on("player",function(a){1==a.n&&(d.position.y=a.y);2==a.n&&(e.position.y=a.y)});socket.on("start",function(a){b.position.x=1==a?d.position.x+.1:e.position.x-.1;b.position.y=1==a?d.position.y:e.position.y;b.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(1==
a?k:-k,0,0))});socket.on("showqr",function(a){$("#player"+a).show();$("#photo"+a).hide();v()});v();return a}();q.runRenderLoop(function(){x.render()});window.addEventListener("resize",function(){q.resize()});socket.on("hideqr",function(f){$("#player"+f).hide();$("#photo"+f).show()});socket.on("user-photo",function(f){$("#photo"+f.n).css({background:"url("+f.url+")","background-size":"contain","background-position":"center","background-repeat":"no-repeat"})});socket.on("ready",function(){BGaudio.currentTime=
0;BGaudio.play()});socket.on("connect",function(){socket.emit("resetclients")});BGaudio.addEventListener("ended",function(){this.currentTime=0;this.play()},!1)});